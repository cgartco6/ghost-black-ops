<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ghosts: Back Ops - Marketing Dashboard</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        .marketing-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        
        .platform-card {
            background: var(--accent);
            padding: 15px;
            border-radius: 10px;
            border-left: 4px solid var(--highlight);
        }
        
        .roi-positive { color: #00ff88; }
        .roi-negative { color: #ff4444; }
        
        .performance-metrics {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            margin-top: 10px;
        }
        
        .metric-item {
            text-align: center;
            padding: 10px;
            background: rgba(255,255,255,0.1);
            border-radius: 5px;
        }
    </style>
</head>
<body>
    <div class="dashboard">
        <div class="sidebar">
            <h2>Ghosts: Back Ops</h2>
            <nav>
                <ul>
                    <li><a href="#overview">Game Overview</a></li>
                    <li><a href="#marketing">Marketing AI</a></li>
                    <li><a href="#revenue">Revenue Analytics</a></li>
                    <li><a href="#players">Player Database</a></li>
                    <li><a href="#campaigns">Ad Campaigns</a></li>
                </ul>
            </nav>
        </div>
        
        <div class="main-content">
            <!-- Marketing Overview -->
            <div class="stat-card">
                <h3>Marketing Spend Today</h3>
                <div id="dailySpend" class="stat-number">$0</div>
            </div>
            
            <div class="stat-card">
                <h3>Marketing Revenue</h3>
                <div id="marketingRevenue" class="stat-number revenue-high">$0</div>
            </div>
            
            <div class="stat-card">
                <h3>Overall ROI</h3>
                <div id="overallROI" class="stat-number roi-positive">0%</div>
            </div>
            
            <div class="stat-card">
                <h3>Total Conversions</h3>
                <div id="totalConversions" class="stat-number">0</div>
            </div>

            <!-- Platform Performance -->
            <div class="stat-card" style="grid-column: span 2;">
                <h3>Platform Performance</h3>
                <div class="marketing-grid" id="platformPerformance">
                    <!-- Dynamic platform cards will be inserted here -->
                </div>
            </div>

            <!-- Marketing Charts -->
            <div class="stat-card" style="grid-column: span 2;">
                <h3>ROI by Platform</h3>
                <div class="chart-container">
                    <canvas id="roiChart"></canvas>
                </div>
            </div>
            
            <div class="stat-card" style="grid-column: span 2;">
                <h3>Conversion Funnel</h3>
                <div class="chart-container">
                    <canvas id="funnelChart"></canvas>
                </div>
            </div>

            <!-- Campaign Management -->
            <div class="stat-card" style="grid-column: span 2;">
                <h3>Active Campaigns</h3>
                <div id="campaignsList">
                    <table style="width: 100%;">
                        <thead>
                            <tr>
                                <th>Platform</th>
                                <th>Budget</th>
                                <th>Impressions</th>
                                <th>Conversions</th>
                                <th>ROI</th>
                                <th>Status</th>
                            </tr>
                        </thead>
                        <tbody id="campaignsTableBody">
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <script>
        class MarketingDashboard {
            constructor() {
                this.marketingData = {};
                this.initMarketingCharts();
                this.loadMarketingData();
                setInterval(() => this.updateMarketingData(), 30000); // Update every 30 seconds
            }
            
            initMarketingCharts() {
                // ROI Chart
                this.roiChart = new Chart(document.getElementById('roiChart'), {
                    type: 'bar',
                    data: {
                        labels: [],
                        datasets: [{
                            label: 'ROI %',
                            data: [],
                            backgroundColor: function(context) {
                                const value = context.dataset.data[context.dataIndex];
                                return value >= 0 ? 'rgba(0, 255, 136, 0.8)' : 'rgba(255, 68, 68, 0.8)';
                            }
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false
                    }
                });
                
                // Funnel Chart
                this.funnelChart = new Chart(document.getElementById('funnelChart'), {
                    type: 'doughnut',
                    data: {
                        labels: ['Impressions', 'Clicks', 'Installs', 'Purchases'],
                        datasets: [{
                            data: [10000, 1500, 300, 75],
                            backgroundColor: [
                                '#e94560',
                                '#0f3460', 
                                '#16213e',
                                '#1a1a2e'
                            ]
                        }]
                    }
                });
            }
            
            async loadMarketingData() {
                try {
                    const response = await fetch('/api/marketing/performance');
                    this.marketingData = await response.json();
                    this.updateMarketingDisplay();
                } catch (error) {
                    console.error('Failed to load marketing data:', error);
                }
            }
            
            updateMarketingDisplay() {
                // Update overview metrics
                document.getElementById('dailySpend').textContent = 
                    '$' + this.marketingData.dailySpend.toLocaleString();
                document.getElementById('marketingRevenue').textContent = 
                    '$' + this.marketingData.dailyRevenue.toLocaleString();
                document.getElementById('overallROI').textContent = 
                    this.marketingData.overallROI.toFixed(2) + '%';
                document.getElementById('totalConversions').textContent = 
                    this.marketingData.totalConversions.toLocaleString();
                
                // Update platform performance
                this.updatePlatformCards();
                
                // Update campaigns table
                this.updateCampaignsTable();
                
                // Update charts
                this.updateCharts();
            }
            
            updatePlatformCards() {
                const container = document.getElementById('platformPerformance');
                container.innerHTML = '';
                
                this.marketingData.platforms.forEach(platform => {
                    const card = document.createElement('div');
                    card.className = 'platform-card';
                    card.innerHTML = `
                        <h4>${platform.name}</h4>
                        <div class="performance-metrics">
                            <div class="metric-item">
                                <div>Spend</div>
                                <div>$${platform.spend.toLocaleString()}</div>
                            </div>
                            <div class="metric-item">
                                <div>Revenue</div>
                                <div class="revenue-high">$${platform.revenue.toLocaleString()}</div>
                            </div>
                            <div class="metric-item">
                                <div>ROI</div>
                                <div class="${platform.roi >= 0 ? 'roi-positive' : 'roi-negative'}">
                                    ${platform.roi.toFixed(2)}%
                                </div>
                            </div>
                        </div>
                    `;
                    container.appendChild(card);
                });
            }
            
            updateCampaignsTable() {
                const tbody = document.getElementById('campaignsTableBody');
                tbody.innerHTML = '';
                
                this.marketingData.campaigns.forEach(campaign => {
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>${campaign.platform}</td>
                        <td>$${campaign.budget}</td>
                        <td>${campaign.impressions.toLocaleString()}</td>
                        <td>${campaign.conversions.toLocaleString()}</td>
                        <td class="${campaign.roi >= 0 ? 'roi-positive' : 'roi-negative'}">
                            ${campaign.roi.toFixed(2)}%
                        </td>
                        <td>${campaign.status}</td>
                    `;
                    tbody.appendChild(row);
                });
            }
            
            updateCharts() {
                // Update ROI chart
                this.roiChart.data.labels = this.marketingData.platforms.map(p => p.name);
                this.roiChart.data.datasets[0].data = this.marketingData.platforms.map(p => p.roi);
                this.roiChart.update();
            }
        }
        
        // Initialize marketing dashboard
        document.addEventListener('DOMContentLoaded', () => {
            new MarketingDashboard();
        });
    </script>
</body>
</html>
